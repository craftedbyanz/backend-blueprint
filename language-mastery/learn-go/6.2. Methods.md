# Methods

Go cho phÃ©p báº¡n gáº¯n hÃ m (method) vÃ o má»™t kiá»ƒu dá»¯ liá»‡u do báº¡n Ä‘á»‹nh nghÄ©a, nhÆ° struct.

```
type Person struct {
    FirstName string
    LastName  string
    Age       int
}

func (p Person) String() string {
    return fmt.Sprintf("%s %s, age %d", p.FirstName, p.LastName, p.Age)
}
```

- func (p Person) chÃ­nh lÃ  `receiver`: NÃ³ nÃ³i ráº±ng hÃ m nÃ y lÃ  method cá»§a Person.
- p lÃ  biáº¿n Ä‘áº¡i diá»‡n cho instance Ä‘ang gá»i method (p.String()).
- String() lÃ  tÃªn method.
- Method nÃ y tráº£ vá» má»™t string.

**CÃº phÃ¡p receiver**

```
func (receiverName TypeName) MethodName(...) ReturnType {
    // implementation
}

Ex:
func (t Triangle) Area() float64
func (a Account) Deposit(amount float64)
```

**Convention trong Go:**

- DÃ¹ng `chá»¯ viáº¿t táº¯t tÃªn type` lÃ m tÃªn receiver, thÆ°á»ng lÃ  chá»¯ cÃ¡i Ä‘áº§u tiÃªn.
- TrÃ¡nh dÃ¹ng this hay self (khÃ´ng idiomatic trong Go).

**Method khÃ´ng há»— trá»£ overloading**
NghÄ©a lÃ  báº¡n `khÃ´ng thá»ƒ Ä‘á»‹nh nghÄ©a nhiá»u method trÃ¹ng tÃªn cho cÃ¹ng má»™t type,` ngay cáº£ náº¿u chÃºng cÃ³ tham sá»‘ khÃ¡c nhau
KhÃ´ng há»£p lá»‡

```
func (p Person) Print() {}
func (p Person) Print(s string) {} // lá»—i: duplicate method
```

Há»£p lá»‡: CÃ³ thá»ƒ dÃ¹ng cÃ¹ng tÃªn method á»Ÿ nhiá»u type khÃ¡c nhau:

```
func (p Person) String() string { ... }
func (c Car) String() string { ... }
```

**Method pháº£i á»Ÿ cÃ¹ng package vá»›i type**

- Go khÃ´ng cho phÃ©p báº¡n gáº¯n thÃªm method vÃ o type mÃ  báº¡n khÃ´ng sá»Ÿ há»¯u, náº¿u nÃ³ náº±m á»Ÿ package khÃ¡c.

```
// Trong package "mypkg"
type Person struct { ... }
func (p Person) Greet() string { ... }

// á» package khÃ¡c: KHÃ”NG thá»ƒ lÃ m
// func (p Person) NewMethod() { ... } // âŒ Sai
```

> NhÆ°ng báº¡n cÃ³ thá»ƒ chia type vÃ  method ra nhiá»u file trong cÃ¹ng má»™t package.

**Value Receiver vs. Pointer Receiver**

- Value Receiver (func (c T)):
  - Method khÃ´ng thay Ä‘á»•i tráº¡ng thÃ¡i cá»§a struct.
  - Struct nhá» (lightweight).
- Pointer Receiver (func (c \*T))
  - Method thay Ä‘á»•i trÆ°á»ng bÃªn trong.
  - TrÃ¡nh copy struct lá»›n.
  - Muá»‘n method xá»­ lÃ½ Ä‘Æ°á»£c nil receiver.

```
type Counter struct {
    total       int
    lastUpdated time.Time
}

func (c *Counter) Increment() { // cÃ³ pointer receiver vÃ¬ nÃ³ thay Ä‘á»•i state cá»§a struct.
    c.total++
    c.lastUpdated = time.Now()
}

func (c Counter) String() string { // cÃ³ value receiver vÃ¬ nÃ³ chá»‰ Ä‘á»c dá»¯ liá»‡u.
    return fmt.Sprintf("total: %d, last updated: %v", c.total, c.lastUpdated)
}
```

**â“ Khi nÃ o thÃ¬ nÃªn dÃ¹ng function? Khi nÃ o thÃ¬ nÃªn dÃ¹ng method?**

- Náº¿u logic `phá»¥ thuá»™c vÃ o tráº¡ng thÃ¡i cá»§a má»™t instance` â†’ DÃ¹ng `method`

  - Cáº§n dÃ¹ng hoáº·c thay Ä‘á»•i giÃ¡ trá»‹ ná»™i táº¡i cá»§a struct (stateful logic).
  - CÃ³ má»™t "ngá»¯ cáº£nh" (context) cá»¥ thá»ƒ Ä‘i kÃ¨m vá»›i hÃ nh vi (behavior).
  - Cáº§n test, mock, hoáº·c inject instance cá»¥ thá»ƒ.

- Náº¿u logic `chá»‰ phá»¥ thuá»™c vÃ o input parameters` â†’ DÃ¹ng `function`
  - Logic khÃ´ng phá»¥ thuá»™c vÃ o báº¥t ká»³ state nÃ o ngoÃ i tham sá»‘ Ä‘áº§u vÃ o.
  - Dá»… test, dá»… tÃ¡i sá»­ dá»¥ng, khÃ´ng bá»‹ rÃ ng buá»™c vÃ o má»™t kiá»ƒu cá»¥ thá»ƒ.

**â— Khai bÃ¡o kiá»ƒu má»›i trong Go KHÃ”NG PHáº¢I lÃ  káº¿ thá»«a (inheritance) - má»™t Ä‘iá»ƒm ráº¥t quan trá»ng vÃ  thÆ°á»ng gÃ¢y hiá»ƒu nháº§m trong Go**

Type Declaration â‰  Inheritance

```
type Score int
type HighScore Score
```

- Score lÃ  má»™t kiá»ƒu má»›i vá»›i underlying type lÃ  int.
- HighScore lÃ  má»™t kiá»ƒu má»›i khÃ¡c, vá»›i underlying type lÃ  Score (â†’ giÃ¡n tiáº¿p lÃ  int).
- NhÆ°ng:
  - Score â‰  int
  - HighScore â‰  Score

Minh há»a: Type Declarations khÃ´ng cÃ³ quan há»‡ káº¿ thá»«a

```
type Score int
type HighScore Score

var i int = 300
var s Score = 100
var hs HighScore = 200

hs = s               // âŒ compilation error!
s = i                // âŒ compilation error!
s = Score(i)         // âœ… explicit conversion
hs = HighScore(s)    // âœ… explicit conversion

func (s Score) IsPerfect() bool {
    return s == 100
}

// method sets
var s Score = 100
s.IsPerfect()       // âœ…

var hs HighScore = 100
hs.IsPerfect()      // âŒ compilation error!

```

- Báº¡n `khÃ´ng thá»ƒ gÃ¡n trá»±c tiáº¿p` giá»¯a cÃ¡c kiá»ƒu khai bÃ¡o, dÃ¹ chÃºng cÃ³ cÃ¹ng underlying type.
- Báº¡n pháº£i dÃ¹ng `Ã©p kiá»ƒu tÆ°á»ng minh (explicit type conversion).`
- VÃ¬ tháº¿, khÃ´ng cÃ³ "tÃ­nh cháº¥t thay tháº¿" (substitutability) nhÆ° trong inheritance.
- HighScore `khÃ´ng â€œkáº¿ thá»«aâ€ method` cá»§a Score
- Method set KHÃ”NG Ä‘Æ°á»£c truyá»n sang kiá»ƒu má»›i dÃ¹ underlying type giá»‘ng nhau

**Váº­y khi nÃ o nÃªn dÃ¹ng type declaration?**

- âœ” Táº¡o loáº¡i riÃªng (newtype) Ä‘á»ƒ tÄƒng Ä‘á»™ an toÃ n kiá»ƒu:

  ```
  type UserID string
  type Email string

  func SendWelcomeEmail(e Email) { ... }

  // Gá»i sai:
  SendWelcomeEmail("1234")        // âŒ náº¿u dÃ¹ng string
  SendWelcomeEmail(Email("1234")) // âœ…
  ```

  - â†’ Háº¡n cháº¿ nháº§m láº«n giá»¯a cÃ¡c string cÃ³ ngá»¯ nghÄ©a khÃ¡c nhau.

- âœ” GÃ¡n thÃªm method cho built-in type:

  ```
  type Score int

  func (s Score) Grade() string {
  	switch {
  	case s >= 90:
  		return "A"
  	case s >= 80:
  		return "B"
  	default:
  		return "F"
  	}
  }
  ```

### ğŸš« KhÃ´ng cÃ³ káº¿ thá»«a, nhÆ°ng cÃ³ composition

Go `khuyáº¿n khÃ­ch composition hÆ¡n inheritance.` Thay vÃ¬ má»Ÿ rá»™ng class nhÆ° trong OOP, báº¡n cÃ³ thá»ƒ â€œnhÃºngâ€ (embed) má»™t struct vÃ o struct khÃ¡c:

```
type Person struct {
    Name string
}

type Employee struct {
    Person  // embedded
    ID      int
}
```

> â†’ Employee cÃ³ thá»ƒ truy cáº­p trá»±c tiáº¿p Employee.Name, nhÆ° thá»ƒ káº¿ thá»«a tá»« Person.

## Embedding (nhÃºng) trong Go â€” má»™t ká»¹ thuáº­t máº¡nh máº½ giÃºp tÃ¡i sá»­ dá»¥ng code thÃ´ng qua composition (thÃ nh pháº§n) thay vÃ¬ inheritance (káº¿ thá»«a) nhÆ° trong OOP truyá»n thá»‘ng.

```
type Employee struct {
	Name string
	ID   string
}

type Manager struct {
	Employee         // embedded field
	Reports []Employee
}
```

- Trong Go, báº¡n cÃ³ thá»ƒ `nhÃºng má»™t struct vÃ o struct khÃ¡c mÃ  khÃ´ng cáº§n Ä‘áº·t tÃªn trÆ°á»ng`
- Nhá» embedding, struct Manager `tá»± Ä‘á»™ng â€œthá»«a hÆ°á»Ÿngâ€` cÃ¡c field vÃ  method tá»« Employee.

**ğŸ¯ Lá»£i Ã­ch cá»§a embedding**

1. TÃ¡i sá»­ dá»¥ng logic (composition) mÃ  khÃ´ng cáº§n inheritance.
2. Field/method Ä‘Æ°á»£c promoted, cÃ³ thá»ƒ gá»i trá»±c tiáº¿p tá»« struct chá»©a nÃ³.

```
m := Manager{
	Employee: Employee{Name: "Bob", ID: "123"},
}
fmt.Println(m.ID) // OK â€“ promoted field
fmt.Println(m.Description()) // OK â€“ promoted method
```

- Khi struct Manager embed struct Employee, Go tá»± Ä‘á»™ng â€œnÃ¢ng cáº¥pâ€ (promote) cÃ¡c field vÃ  method cá»§a Employee lÃªn Manager.
- Báº¡n cÃ³ thá»ƒ truy cáº­p trá»±c tiáº¿p nhÆ° thá»ƒ Manager cÃ³ chÃºng.

## âŒ Embedding khÃ´ng pháº£i lÃ  Inheritance

**âš ï¸ KhÃ´ng thá»ƒ gÃ¡n Manager cho Employee**
DÃ¹ Manager cÃ³ embed Employee, báº¡n khÃ´ng thá»ƒ gÃ¡n kiá»ƒu Manager cho biáº¿n kiá»ƒu Employee:

```
m := Manager{...}
var eFail Employee = m         // âŒ error!
var eOK Employee = m.Employee  // âœ… ok
```

> Go khÃ´ng cÃ³ quan há»‡ "is-a" nhÆ° trong káº¿ thá»«a OOP. Thay vÃ o Ä‘Ã³ lÃ  "has-a".

**ğŸ“Œ KhÃ´ng cÃ³ dynamic dispatch cho concrete types**
Má»™t Ä‘iá»ƒm ná»¯a ráº¥t khÃ¡c biá»‡t lÃ  method dispatch trong Go khÃ´ng hoáº¡t Ä‘á»™ng nhÆ° cÃ¡c ngÃ´n ngá»¯ OOP.

```
type Inner struct {
    A int
}
func (i Inner) IntPrinter(val int) string {
    return fmt.Sprintf("Inner: %d", val)
}
func (i Inner) Double() string {
    return i.IntPrinter(i.A * 2)
}

type Outer struct {
    Inner
    S string
}
func (o Outer) IntPrinter(val int) string {
    return fmt.Sprintf("Outer: %d", val)
}

// Khi call
o := Outer{Inner: Inner{A: 10}}
fmt.Println(o.Double())
```

- Káº¿t quáº£ lÃ : Inner: 20
- Äiá»u nÃ y chá»©ng minh ráº±ng Inner.Double() gá»i Inner.IntPrinter(), khÃ´ng pháº£i Outer.IntPrinter() â€” máº·c dÃ¹ báº¡n gá»i qua biáº¿n Outer.

VÃ¬ sao láº¡i nhÆ° váº­y?

- KhÃ´ng cÃ³ dynamic dispatch cho concrete types (nhÆ° Outer hay Inner).
- Method trÃªn Inner khÃ´ng biáº¿t nÃ³ Ä‘Æ°á»£c embed vÃ o struct khÃ¡c.
- Go chá»‰ cÃ³ dynamic dispatch cho interface, khÃ´ng cho struct.

**âœ… Tuy váº­y: Embedded methods Ä‘Æ°á»£c "káº¿ thá»«a" vÃ o method set**
Máº·c dÃ¹ khÃ´ng cÃ³ inheritance, nhÆ°ng cÃ¡c method tá»« Employee sáº½ xuáº¥t hiá»‡n trong method set cá»§a Manager, nghÄ©a lÃ  báº¡n váº«n gá»i Ä‘Æ°á»£c nhÆ° sau:

```
m := Manager{...}
m.Description() // OK â€“ method tá»« Employee
```

> Äiá»u nÃ y Ä‘áº·c biá»‡t há»¯u Ã­ch khi lÃ m viá»‡c vá»›i interface. Náº¿u Employee implement má»™t interface, thÃ¬ Manager cÅ©ng cÃ³ thá»ƒ implement Ä‘Æ°á»£c nÃ³ nhá» embedding.
